# 🎵 沉浸式音乐功能详解

## 功能概述

code-zen 内置了专为开发者设计的沉浸式音乐功能，通过播放专注音乐来营造理想的编码氛围，帮助开发者进入和保持心流状态。

## 🎯 设计理念

### 为什么需要专注音乐？
- **屏蔽干扰**：过滤环境噪音，创造专注的工作环境
- **节奏同步**：音乐节拍与思维节奏同步，提升编码效率
- **情绪调节**：舒缓的音乐有助于缓解编程压力
- **习惯养成**：固定的音乐环境有助于快速进入工作状态

### ADHD 专注音乐的选择
我们选择了 ADHD（注意力缺陷多动障碍）专注音乐，因为：
- **科学依据**：经过研究验证，有助于提升专注力
- **无歌词设计**：避免语言干扰，不影响代码思考
- **循环友好**：10分钟循环播放，不会产生听觉疲劳
- **频率优化**：特定频率有助于大脑进入专注状态

## 🔧 技术实现

### 架构设计
```
音频文件 (ADHD_01.mp3) 
    ↓
Tauri 资源管理 (resources/music/)
    ↓
HTML5 Audio API
    ↓
React 音乐管理器 (MusicManager)
    ↓
设置界面集成
```

### 核心组件

#### 1. MusicManager 类
```typescript
class MusicManager {
  private audio: HTMLAudioElement | null = null
  private settings: MusicSettings = {
    enabled: false,
    volume: 50,
    autoPlay: true
  }
  
  // 初始化音频
  async init(settings?: MusicSettings)
  
  // 播放控制
  async play()
  pause()
  toggle()
  
  // 音量控制
  setVolume(volume: number)
  
  // 设置管理
  updateSettings(settings: Partial<MusicSettings>)
}
```

#### 2. 设置界面集成
- **启用开关**：一键开启/关闭音乐功能
- **播放控制**：实时播放/暂停按钮
- **音量调节**：0-100% 音量滑块
- **自动播放**：启动时自动播放设置

## 🎮 用户体验

### 使用流程
1. **首次设置**：在健康设置中启用专注音乐
2. **自动播放**：应用启动时自动开始播放（可选）
3. **实时控制**：随时通过设置页面控制播放状态
4. **音量调节**：根据环境调整合适的音量
5. **循环播放**：音乐自动循环，无需手动操作

### 界面设计
```
┌─ 专注音乐 ─────────────────────────┐
│ ☑️ 启用专注音乐                     │
│ 循环播放 ADHD_01.mp3 (10分钟)      │
│                                   │
│ 音乐控制：                         │
│ [▶️ 播放] [音量: ████░░░░ 50%]      │
│ ☑️ 启动时自动播放                   │
└─────────────────────────────────┘
```

## 📊 数据持久化

### 设置存储
音乐设置作为健康管理配置的一部分存储：
```json
{
  "music": {
    "enabled": true,
    "volume": 50,
    "auto_play": true
  }
}
```

### 状态同步
- 设置更改实时保存到 SQLite 数据库
- 应用重启后自动恢复上次设置
- 跨会话状态保持

## 🔮 未来扩展

### 短期计划
- [ ] **音乐库扩展**：支持多种音乐类型
  - 白噪音（雨声、海浪声）
  - 自然音（森林、鸟鸣）
  - Lo-Fi 音乐
  - 古典音乐片段

- [ ] **智能推荐**：根据编码场景推荐音乐
  - 调试模式：舒缓音乐
  - 创作模式：激发灵感的音乐
  - 重构模式：节奏感强的音乐

### 长期愿景
- [ ] **个性化音乐库**：用户自定义音乐文件
- [ ] **AI 音乐生成**：根据代码复杂度生成音乐
- [ ] **团队同步**：团队成员音乐同步播放
- [ ] **生物反馈**：结合心率等数据调整音乐

## 🎵 音乐文件信息

### 当前音乐
- **文件名**：ADHD_01.mp3
- **时长**：约 10 分钟
- **格式**：MP3
- **特点**：专为 ADHD 患者设计的专注音乐
- **循环**：无缝循环播放

### 音质参数
- **采样率**：44.1 kHz
- **比特率**：128 kbps
- **声道**：立体声
- **文件大小**：约 7-10 MB

## 🛠️ 开发者指南

### 添加新音乐文件
1. 将音频文件放入 `src-tauri/resources/music/` 目录
2. 更新 `tauri.conf.json` 中的资源配置
3. 修改 `MusicManager` 中的文件路径
4. 测试音频加载和播放功能

### 自定义音乐控制
```typescript
// 获取音乐管理器实例
import { musicManager } from '@/lib/music'

// 播放控制
musicManager.play()
musicManager.pause()
musicManager.toggle()

// 音量控制
musicManager.setVolume(75)

// 设置更新
musicManager.updateSettings({
  enabled: true,
  volume: 60,
  autoPlay: false
})
```

## 🎯 总结

沉浸式音乐功能是 code-zen 的重要组成部分，它不仅提供了技术上的创新，更重要的是为开发者创造了一个更加专注、舒适的编码环境。通过科学选择的 ADHD 专注音乐，帮助开发者在保持身心健康的同时，提升编码效率和代码质量。

这个功能体现了 code-zen "专注编码，禅意生活" 的核心理念，让技术真正服务于人的全面发展。